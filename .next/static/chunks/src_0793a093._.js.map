{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/yetzu-git-repo/Yetzu-Frontend-repo/src/providers/ToastProvider.tsx"],"sourcesContent":["\"use client\";\r\nimport { Toaster } from \"react-hot-toast\";\r\n\r\nexport default function ToastProvider() {\r\n    return (\r\n        <Toaster\r\n            position=\"top-right\"\r\n            toastOptions={{\r\n                duration: 3000,\r\n                style: {\r\n                    background: \"#333\",\r\n                    color: \"#fff\",\r\n                },\r\n            }}\r\n        />\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AADA;;;AAGe,SAAS;IACpB,qBACI,6LAAC,qKAAO;QACJ,UAAS;QACT,cAAc;YACV,UAAU;YACV,OAAO;gBACH,YAAY;gBACZ,OAAO;YACX;QACJ;;;;;;AAGZ;KAbwB","debugId":null}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///D:/yetzu-git-repo/Yetzu-Frontend-repo/src/lib/axios.ts"],"sourcesContent":["import axios, { AxiosError } from \"axios\";\r\nimport toast from \"react-hot-toast\";\r\nconst BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;\r\n\r\n// Public Axios instance\r\nexport const api = axios.create({\r\n  baseURL: BASE_URL,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\n// 2ï¸âƒ£ Authenticated Axios instance\r\nexport const authApi = axios.create({\r\n  baseURL: BASE_URL,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\n// ðŸ”¹ Request interceptor to attach access token\r\nauthApi.interceptors.request.use(async (config) => {\r\n  const accessToken = localStorage.getItem(\"accessToken\") || \"\";\r\n  const token = accessToken;\r\n\r\n  if (token && config.headers) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n\r\n  return config;\r\n});\r\n\r\nauthApi.interceptors.response.use(\r\n  (response) => response,\r\n  async (error: AxiosError) => {\r\n    const originalRequest = error.config as any;\r\n\r\n    // Prevent infinite loops\r\n    if (error.response?.status === 401 && !originalRequest._retry) {\r\n      originalRequest._retry = true;\r\n\r\n      const user = localStorage.getItem(\"user\") || null;\r\n      const refreshToken = localStorage.getItem(\"refreshToken\");\r\n      try {\r\n        if (!refreshToken) throw new Error(\"No refresh token available\");\r\n\r\n        // Refresh the access token\r\n        const { data } = await api.post(\"/identityapi/v1/auth/refresh\", {\r\n          refreshToken,\r\n        });\r\n\r\n        // Save new token to session (you can also update next-auth session here)\r\n        const newAccessToken = data?.accessToken;\r\n        if (!newAccessToken) throw new Error(\"No new token received\");\r\n\r\n        // Update the Authorization header and retry the request\r\n        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\r\n\r\n        return authApi(originalRequest);\r\n      } catch (err) {\r\n        console.error(\"Token refresh failed, redirecting to login\", err);\r\n        if (user) {\r\n          const res = await authApi.post(\"/api/signout\", {\r\n            userId: JSON.parse(user).user_id,\r\n          });\r\n          if (res.status === 200) {\r\n            toast.success(\"Logged out successfully!\");\r\n            localStorage.removeItem(\"accessToken\");\r\n            localStorage.removeItem(\"user\");\r\n            localStorage.removeItem(\"refreshToken\");\r\n          } else {\r\n            toast.error(\"Logout failed!\");\r\n          }\r\n        }\r\n        toast.error(\"Session expired. Please log in again.\");\r\n      }\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n"],"names":[],"mappings":";;;;;;AAEiB;AAFjB;AACA;;;AACA,MAAM;AAGC,MAAM,MAAM,mJAAK,CAAC,MAAM,CAAC;IAC9B,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAGO,MAAM,UAAU,mJAAK,CAAC,MAAM,CAAC;IAClC,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAEA,gDAAgD;AAChD,QAAQ,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO;IACtC,MAAM,cAAc,aAAa,OAAO,CAAC,kBAAkB;IAC3D,MAAM,QAAQ;IAEd,IAAI,SAAS,OAAO,OAAO,EAAE;QAC3B,OAAO,OAAO,CAAC,aAAa,GAAG,AAAC,UAAe,OAAN;IAC3C;IAEA,OAAO;AACT;AAEA,QAAQ,YAAY,CAAC,QAAQ,CAAC,GAAG,CAC/B,CAAC,WAAa,UACd,OAAO;QAID;IAHJ,MAAM,kBAAkB,MAAM,MAAM;IAEpC,yBAAyB;IACzB,IAAI,EAAA,kBAAA,MAAM,QAAQ,cAAd,sCAAA,gBAAgB,MAAM,MAAK,OAAO,CAAC,gBAAgB,MAAM,EAAE;QAC7D,gBAAgB,MAAM,GAAG;QAEzB,MAAM,OAAO,aAAa,OAAO,CAAC,WAAW;QAC7C,MAAM,eAAe,aAAa,OAAO,CAAC;QAC1C,IAAI;YACF,IAAI,CAAC,cAAc,MAAM,IAAI,MAAM;YAEnC,2BAA2B;YAC3B,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI,CAAC,gCAAgC;gBAC9D;YACF;YAEA,yEAAyE;YACzE,MAAM,iBAAiB,iBAAA,2BAAA,KAAM,WAAW;YACxC,IAAI,CAAC,gBAAgB,MAAM,IAAI,MAAM;YAErC,wDAAwD;YACxD,gBAAgB,OAAO,CAAC,aAAa,GAAG,AAAC,UAAwB,OAAf;YAElD,OAAO,QAAQ;QACjB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,8CAA8C;YAC5D,IAAI,MAAM;gBACR,MAAM,MAAM,MAAM,QAAQ,IAAI,CAAC,gBAAgB;oBAC7C,QAAQ,KAAK,KAAK,CAAC,MAAM,OAAO;gBAClC;gBACA,IAAI,IAAI,MAAM,KAAK,KAAK;oBACtB,qKAAK,CAAC,OAAO,CAAC;oBACd,aAAa,UAAU,CAAC;oBACxB,aAAa,UAAU,CAAC;oBACxB,aAAa,UAAU,CAAC;gBAC1B,OAAO;oBACL,qKAAK,CAAC,KAAK,CAAC;gBACd;YACF;YACA,qKAAK,CAAC,KAAK,CAAC;QACd;IACF;IAEA,OAAO,QAAQ,MAAM,CAAC;AACxB","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///D:/yetzu-git-repo/Yetzu-Frontend-repo/src/providers/SessionProvider.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { api, authApi } from \"@/lib/axios\";\r\nimport React, { createContext, useContext, useEffect, useState, ReactNode } from \"react\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nexport type UserType = {\r\n    created_at: string;\r\n    email: string;\r\n    email_verified: boolean;\r\n    identities: {\r\n        user_id: string;\r\n        provider: string;\r\n        connection: string;\r\n        isSocial: boolean;\r\n    };\r\n    name: string;\r\n    role: string;\r\n    updated_at: string;\r\n    user_id: string;\r\n    last_ip: string;\r\n    last_login: string;\r\n    last_password_reset: string;\r\n    logins_count: number;\r\n};\r\n\r\nconst DEFAULT_USER: UserType = {\r\n    created_at: '',\r\n    email: '',\r\n    email_verified: false,\r\n    identities: {\r\n        user_id: '',\r\n        provider: '',\r\n        connection: '',\r\n        isSocial: false,\r\n    },\r\n    name: 'User',\r\n    role: '',\r\n    updated_at: '',\r\n    user_id: '',\r\n    last_ip: '',\r\n    last_login: '',\r\n    last_password_reset: '',\r\n    logins_count: 0\r\n};\r\n\r\n\r\ntype UserContextType = {\r\n    user: UserType;\r\n    setUser: React.Dispatch<React.SetStateAction<UserType>>;\r\n    logout: () => Promise<void>;\r\n    refershSession: boolean;\r\n    accessToken: string;\r\n    refreshToken: string;\r\n};\r\n\r\nexport const SessionContext = createContext<UserContextType | undefined>(undefined);\r\n\r\nexport const SessionProvider = ({ children }: { children: ReactNode }) => {\r\n    const [user, setUser] = useState<UserType>(DEFAULT_USER);\r\n    const accessToken = typeof window !== \"undefined\" ? localStorage.getItem(\"accessToken\") || '' : '';\r\n    const refreshToken = typeof window !== \"undefined\" ? localStorage.getItem(\"refreshToken\") || '' : '';\r\n\r\n    useEffect(() => {\r\n        const storedUser = localStorage.getItem(\"user\");\r\n        if (storedUser) setUser(JSON.parse(storedUser));\r\n    }, []);\r\n\r\n    const logout = async () => {\r\n        if (!user) return;\r\n        try {\r\n            const res = await authApi.post(\"/identityapi/v1/auth/signout\", { userId: user.user_id });\r\n            if (res.status === 200) {\r\n                toast.success(\"Logged out successfully!\");\r\n                localStorage.removeItem(\"accessToken\");\r\n                localStorage.removeItem(\"refreshToken\");\r\n                localStorage.removeItem(\"user\");\r\n                setUser(DEFAULT_USER);\r\n            } else {\r\n                toast.error(`Logout failed: ${res.statusText || res.status}`);\r\n                console.error(\"Logout failed:\", res.data);\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(`Logout error: ${error?.message || \"Something went wrong\"}`);\r\n            console.error(\"Logout error:\", error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <SessionContext.Provider value={{ user, setUser, logout, accessToken, refreshToken, refershSession: false }}>\r\n            {children}\r\n        </SessionContext.Provider>\r\n    );\r\n};"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;;;AAJA;;;;AA0BA,MAAM,eAAyB;IAC3B,YAAY;IACZ,OAAO;IACP,gBAAgB;IAChB,YAAY;QACR,SAAS;QACT,UAAU;QACV,YAAY;QACZ,UAAU;IACd;IACA,MAAM;IACN,MAAM;IACN,YAAY;IACZ,SAAS;IACT,SAAS;IACT,YAAY;IACZ,qBAAqB;IACrB,cAAc;AAClB;AAYO,MAAM,+BAAiB,IAAA,8KAAa,EAA8B;AAElE,MAAM,kBAAkB;QAAC,EAAE,QAAQ,EAA2B;;IACjE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAW;IAC3C,MAAM,cAAc,uCAAgC,aAAa,OAAO,CAAC,kBAAkB,KAAK;IAChG,MAAM,eAAe,uCAAgC,aAAa,OAAO,CAAC,mBAAmB,KAAK;IAElG,IAAA,0KAAS;qCAAC;YACN,MAAM,aAAa,aAAa,OAAO,CAAC;YACxC,IAAI,YAAY,QAAQ,KAAK,KAAK,CAAC;QACvC;oCAAG,EAAE;IAEL,MAAM,SAAS;QACX,IAAI,CAAC,MAAM;QACX,IAAI;YACA,MAAM,MAAM,MAAM,iIAAO,CAAC,IAAI,CAAC,gCAAgC;gBAAE,QAAQ,KAAK,OAAO;YAAC;YACtF,IAAI,IAAI,MAAM,KAAK,KAAK;gBACpB,qKAAK,CAAC,OAAO,CAAC;gBACd,aAAa,UAAU,CAAC;gBACxB,aAAa,UAAU,CAAC;gBACxB,aAAa,UAAU,CAAC;gBACxB,QAAQ;YACZ,OAAO;gBACH,qKAAK,CAAC,KAAK,CAAC,AAAC,kBAA8C,OAA7B,IAAI,UAAU,IAAI,IAAI,MAAM;gBAC1D,QAAQ,KAAK,CAAC,kBAAkB,IAAI,IAAI;YAC5C;QACJ,EAAE,OAAO,OAAY;YACjB,qKAAK,CAAC,KAAK,CAAC,AAAC,iBAAyD,OAAzC,CAAA,kBAAA,4BAAA,MAAO,OAAO,KAAI;YAC/C,QAAQ,KAAK,CAAC,iBAAiB;QACnC;IACJ;IAEA,qBACI,6LAAC,eAAe,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;YAAQ;YAAa;YAAc,gBAAgB;QAAM;kBACrG;;;;;;AAGb;GAnCa;KAAA","debugId":null}}]
}